<!--
    @license
    Copyright (c) 2015 Ana Isabel Lopera Martínez
    This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
    The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
    The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
    Code distributed by Google as part of the polymer project is also
    subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
  -->
  <link rel="import" href="bower_components/polymer/polymer.html">
  <link rel="import" href="bower_components/paper-button/paper-button.html">
  <link rel="import" href="bower_components/core-icon/core-icon.html">

<!--
Web component for login instagram button.

##### Example

    <instagram-login></instagram-login>

@element instagram-login
@blurb Web component for login instagram button.
@status beta
@homepage http://polymerlabs.github.io/instagram-login
-->
<polymer-element name="instagram-login" attributes="clientId redirectUri">

<template>

  <link rel="stylesheet" href="instagram-login.css">
  <paper-button id="InstagramButton" on-click="{{login}}"> 
  <core-icon src="ig-badge-48.png" style="width: 24px; height: 24px;"></core-icon>
  Sign in with Instagram</paper-button>
</template>

<script>

Polymer({
      /**
       * The `clientId` attribute is the client_Id defined in the Instagram App 
       * @attribute clientId
       * @type string
       * @default ''
       */
       clientId: '',

      /**
       * The `redirectUri` attribute is the callback url define in the Instagram App
       * @attribute redirectUri
       * @type string
       * @default ''
       */
       redirectUri: '',

       /**
       * The `access_token` property is returned when the login process is completed
       * @property access_token
       * @type string
       * @default ''
       */
       access_token: '',

      /**
       * The `login` method opens a window to instagram authorization page to 
       * complete the login process. Called when when is pressed the InstagramButton
       * @method login
       * @param {String} event
       * @param {String} detail
       * @param {String} sender
       * @return {void}
       */
       login: function(event, detail, sender) {
        var oauth_url = "https://instagram.com/oauth/authorize?client_id=" + this.clientId
        + "&redirect_uri=" + this.redirectUri + "&response_type=token";
        var win = window.open(oauth_url, "Autoriza la aplicación",'width=800, height=600');
        var polTimer = window.setInterval(function(){
          try {
            if(win.document.URL.indexOf('cool-poly-lab') != -1){
              window.clearInterval(polTimer);
              var url = win.document.URL;
              var patron = "access_token"+"=([^&#]*)";
              var exp = new RegExp(patron);
              this.access_token = exp.exec(url)[1];
              win.close();
            }
          }catch(e){

          }
        }, 3000);
      }
    });

</script>

</polymer-element>
